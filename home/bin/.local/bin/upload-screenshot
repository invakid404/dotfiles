#!/bin/bash

# Required parameters:
# @raycast.schemaVersion 1
# @raycast.title Take Screenshot
# @raycast.mode silent
#
# Optional parameters:
# @raycast.packageName Scripts

set -e

# Define the filename and file path
FILENAME="$(date -u +%Y-%m-%d_%H-%M-%S).png"
FILEPATH="/tmp/${FILENAME}"

# Check if flameshot is available
if command -v flameshot >/dev/null 2>&1; then
    flameshot gui -p "${FILEPATH}"
elif command -v screencapture >/dev/null 2>&1; then
    # Equivalent to flameshot gui -p. Saves screenshot to FILEPATH
    screencapture -i "${FILEPATH}"
else
    echo "Error: Neither flameshot nor screencapture is available." >&2
    exit 1
fi

# Check if the screenshot was taken and exists
if [ ! -f "${FILEPATH}" ]; then
    echo "Screenshot was not taken."
    exit 1
fi

# Call the upload script
"$HOME/.local/bin/upload-image" "${FILEPATH}"

# Cleanup
rm "${FILEPATH}"
